<!DOCTYPE html>
<html>
<head>
    <title> Oficina Mecânica</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.15.2/axios.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
</head>
<body class=" bg-primary-subtle">

<div id="app">
    <nav class="navbar navbar-expand-lg border-bottom border-dark bg-body-tertiary fs-6 text-body" style="--bs-border-opacity: .5;">
        <div class="container-fluid">
          <a class="navbar-brand" href="#"><i class="bi bi-gear-wide-connected me-1"></i>Oficina Mecânica</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link active" aria-current="page" href="">Menu</a></li>
                <li class="nav-item"><a class="nav-link">Contato</a></li>
                <li class="nav-item"><a class="nav-link">Quem somos</a></li>
            </ul>
            <div class="navbar-nav justify-content-left">
                <button class=" nav-link text-start" data-bs-toggle="modal" data-bs-target="#loginModal"> Iniciar Sessão</button>
                <div class="modal" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                        <h1 class="modal-title fs-5" id="loginModalLabel">Iniciar Sessão</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <form class="container-fluid" id="loginForm" @submit.prevent="doLogin()">
                            <div class="modal-body row gy-3 justify-content-center">
                                <div class="col-8">
                                    <div class="form-floating" id="usernameContainer">
                                        <input class="form-control " type="text" v-model="user.username" id="username" @input="doEraseInvalidState('usernameContainer')" required>
                                        <label class="form-label" for="username">Usuário:</label>
                                    </div>
                                </div>
                                <div class="col-8">
                                    <div class="form-floating" id="passwordContainer">
                                        <input class="form-control" type="password" v-model="user.password" id="password" @input="doEraseInvalidState('passwordContainer')" required>
                                        <label class="form-label" for="password">Senha:</label>
                                    </div>                
                                </div>
                            </div>
                        </form>
                        <div class="modal-footer container">
                            <div id="AlertPlaceholder" class="row container-fluid"></div>
                            <div class="row">
                                <button type="button" class="col-auto mx-2 my-2 btn btn-danger" data-bs-dismiss="modal">Fechar</button>
                                <button class="col-auto mx-2 my-2 btn btn-secondary" @click="doOpenRegisterPage()"><i class="bi bi-person-plus me-1"></i>Cadastrar</button>
                                <button class="col-auto mx-2 my-2 btn btn-primary" type="submit" form="loginForm"><i class="bi bi-box-arrow-in-right me-1"></i>Login</button>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
            </div>

          </div>
        </div>
      </nav>


    <div class="container-fluid p-2 v-100">
        <div id="carousel5" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
              <button type="button" data-bs-target="#carousel5" data-bs-slide-to="0" class="active"></button>
              <button type="button" data-bs-target="#carousel5" data-bs-slide-to="1"></button>
              <button type="button" data-bs-target="#carousel5" data-bs-slide-to="2"></button>
            </div>
        
            <div class="carousel-inner rounded-5 shadow-lg ">
              <div class="carousel-item active">
                <img src="images/69803-5-dicas-para-inovar-na-oficina-mecanica.jpg" class="d-block object-fit-cover" width="100%" height="700" alt="foto1"/>
                <div class="carousel-caption d-none d-md-block">
                    <h5>Os melhores serviços da região</h5>
                    <p>Traga seus problemas para nossa equipe especializada e tenha certeza de sua satisfação.</p>
                </div>
              </div>
              <div class="carousel-item">
                <img src="images/2.jpg" class="d-block object-fit-cover" width="100%" height="700" alt="foto2" />
                <div class="carousel-caption d-none d-md-block">
                    <h5>Solicite atendimento pelo site</h5>
                    <p>Ao se cadastrar, você poderá solicitar atendimento para o problema de seu carro do conforto da sua casa!</p>
                </div>
              </div>
              <div class="carousel-item">
                <img src= "images/hv-oficina-mecanica-rolandia-42863_60db4eed4e96a.jpg" class="d-block object-fit-cover" width="100%" height="700" alt="foto3" />
                <div class="carousel-caption d-none d-md-block">
                    <h5>Os melhores preços da região</h5>
                    <p>Nossa equipe política de preços é a mais agrassiva das redondezas. Venha conhecer!</p>
                </div>
              </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carousel5" data-bs-slide="prev">
              <span class="carousel-control-prev-icon"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carousel5" data-bs-slide="next">
              <span class="carousel-control-next-icon"></span>
              <span class="visually-hidden">Next</span>
            </button>
        </div>
        <div class="row my-2">
            <div class="col-sm-6 mb-3 mb-sm-0 ">
              <div class="card border-secondary" style="--bs-border-opacity: .5;">
                <div class="card-body">
                  <h4 class="card-title">Ainda não tem cadastro?</h4>
                  <p class="card-text">Cadastre-se agora mesmo pressionando o botão abaixo.</p>
                  <button class="btn btn-primary" @click="doOpenRegisterPage()">Quero me cadastrar</button>
                </div>
              </div>
            </div>
            <div class="col-sm-6">
              <div class="card border-secondary" style="--bs-border-opacity: .5;">
                <div class="card-body">
                  <h4 class="card-title">Já possui cadastro?</h4>
                  <p class="card-text">Acesse nossos serviços agora mesmo clicando em "Iniciar Sessão", ou pressionando o botão abaixo.</p>
                  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#loginModal">Quero acessar os serviços</button>
                </div>
              </div>
            </div>
          </div>
    </div>
</div>

</body>
</html>
<script type="module">

function openRegisterPage(){
    window.open('/register','_self');
}

function eraseInvalidState(id){
    let containerEl = document.getElementById(id);
    containerEl.firstChild.classList.remove('is-invalid');
}

async function login(){
    let tmp={'user':app.user}
    var data = JSON.stringify(tmp);
    var response;
    var request = axios({
              "method": "post",
              "url": '/login',
              "headers": { "Content-Type": "application/json" },
              "data": data});
    try {
        response = await request;
        open(response.data,'_self');
    } catch (error) {
        document.getElementById('usernameContainer').firstChild.classList.add('is-invalid');
        document.getElementById('passwordContainer').firstChild.classList.add('is-invalid');
        appendAlert(error.response.data,'danger','AlertPlaceholder');
        return;
    }
}

function appendAlert(message, type, id){
    let alertPlaceholder = document.getElementById(id)
    let wrapper = document.createElement('div');
    wrapper.innerHTML = [
        `<div class="row alert alert-${type} alert-dismissible show" role="alert">`,
        `   <div class="col-auto small">`,
        '     <i class="col-1 bi bi-exclamation-triangle"></i>',
        `     <span>${message}</span>`,
        '   </div>',
        '   <button type="button" class="col-1 btn-close" data-bs-dismiss="alert" aria-label="Close" id="alertCloseBtn"></button>',
        '</div>'
    ].join('');

    alertPlaceholder.appendChild(wrapper);
    setTimeout(()=> {
      let el = document.getElementById('alertCloseBtn')
      if(el!=null)el.click();
    },3000);
}

var configdata = {
  el: '#app',
  data: {
        user: {username:'',password:''}
  },
  methods: {
      doOpenRegisterPage: openRegisterPage,
      doLogin: login,
      doEraseInvalidState: eraseInvalidState
  }
}

var app;
window.onload = () => app = new Vue(configdata);
</script>
